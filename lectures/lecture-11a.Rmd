---
title: "ETC3250/5250: Introduction to Machine Learning"
subtitle: "Assessing clustering results"
author: "Professor Di Cook"
email: "ETC3250.Clayton-x@monash.edu"
date: "Week 11a"
length: "50 minutes"
department: "Department of Econometrics and Business Statistics"
titlebgimg: "images/bg-02.png"
output:
  xaringan::moon_reader:
    css:
      - ninjutsu 
      - "assets/font-awesome-all.css"
      - "assets/tachyons-addon.css"
      - "assets/animate.css"
      - "assets/fira-code.css"
      - "assets/boxes.css"
      - "assets/table.css"
      - "assets/styles.css"
      - "assets/monash-brand.css"
      - "assets/monash-fonts.css"
      - "assets/slide-types.css"
      - "assets/custom.css"
      - "assets/panelset.css"
    self_contained: false 
    seal: false 
    chakra: 'lib/remark-latest.min.js'
    includes:
      in_header: "assets/head.html"
    lib_dir: lib
    #includes:
    #  in_header: "assets/custom.html"
    mathjax: "lib/mathjax-local/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
    nature:
      highlightStyle: magula
      highlightLanguage: r 
      highlightLines: true
      highlightSpans: false 
      countIncrementalSlides: false
      slideNumberFormat: '%current%/%total%'
      navigation:
        scroll: false 
        touch: true
        click: false
      ratio: '16:9'
---

```{r, include = FALSE}
current_file <- knitr::current_input()
basename <- gsub(".Rmd$", "", current_file)

knitr::opts_chunk$set(
  fig.path = sprintf("images/%s/", basename),
  fig.width = 6,
  fig.height = 4,
  out.width = "100%",
  fig.align = "center",
  fig.retina = 3,
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  cache = FALSE,
  cache.path = "cache/"
)
```

```{r titleslide, child="assets/titleslide.Rmd"}
```

```{r}
library(tidyverse)
library(tourr)
library(ggdendro)
library(patchwork)
library(GGally)
library(kableExtra)
library(yardstick)
```

---
class: transition

# Where cluster algorithms can be tripped up

---
class: split-50
layout: false


.column[.pad10px[
# Inlier-outlier observations

```{r out.width="90%", fig.width=4, fig.height=4}
  set.seed(20190514)
  x <- (runif(20)-0.5)*4
  y <- x
  df <- data.frame(x1=scale(c(rnorm(50, -3), rnorm(50, 3), x)),
                   x2=scale(c(rnorm(50, -3), rnorm(50, 3), y)))
  ggplot(data=df, aes(x1, x2)) + geom_point() +
    theme_bw() + theme(aspect.ratio=1)
```

]]
.column[.pad50px[

<br><br>
.monash-orange2[Nuisance cases] "Hansel and Gretel data"

Points that are between major clusters of data. This affects some linkage methods, eg single, which will tend to "chain" through the data grouping everything together.
]]

---

```{r out.width="90%", fig.width=10, fig.height=6}
df_dist <- dist(df)
df_hc1 <- hclust(df_dist, method="single")
df_hc2 <- hclust(df_dist, method="complete")
df_hc3 <- hclust(df_dist, method="average")
df_hc4 <- hclust(df_dist, method="centroid")
df_hc5 <- hclust(df_dist, method="ward.D2")
p1 <- ggdendrogram(df_hc1, rotate = TRUE, size = 4) + ggtitle("single")
p2 <- ggdendrogram(df_hc2, rotate = TRUE, size = 4) + ggtitle("complete")
p3 <- ggdendrogram(df_hc3, rotate = TRUE, size = 4) + ggtitle("average")
p4 <- ggdendrogram(df_hc4, rotate = TRUE, size = 4) + ggtitle("centroid")
p5 <- ggdendrogram(df_hc5, rotate = TRUE, size = 4) + ggtitle("wards")
p1 + p2 + p3 + p4 + p5 + plot_layout(ncol=3)
```

---

```{r out.width="90%", fig.width=10, fig.height=6}
df$cl1 <- factor(cutree(df_hc1, 2))
df$cl2 <- factor(cutree(df_hc2, 2))
df$cl3 <- factor(cutree(df_hc3, 2))
df$cl4 <- factor(cutree(df_hc4, 2))
df$cl5 <- factor(cutree(df_hc5, 2))
p1 <- ggplot(data=df, aes(x=x1, y=x2, colour=cl1)) +
  geom_point() +
  scale_color_brewer("", palette="Dark2") +
  xlab("") + ylab("") + theme_bw() +
  theme(aspect.ratio=1, legend.position="none") + ggtitle("single")
p2 <- ggplot(data=df, aes(x=x1, y=x2, colour=cl2)) +
  geom_point() +
  scale_color_brewer("", palette="Dark2") +
  xlab("") + ylab("") + theme_bw() +
  theme(aspect.ratio=1, legend.position="none") +
  ggtitle("complete")
p3 <- ggplot(data=df, aes(x=x1, y=x2, colour=cl3)) +
  geom_point() +
  scale_color_brewer("", palette="Dark2") +
  xlab("") + ylab("") + theme_bw() +
  theme(aspect.ratio=1, legend.position="none") +
  ggtitle("average")
p4 <- ggplot(data=df, aes(x=x1, y=x2, colour=cl4)) +
  geom_point() +
  scale_color_brewer("", palette="Dark2") +
  xlab("") + ylab("") + theme_bw() +
  theme(aspect.ratio=1, legend.position="none") +
  ggtitle("centroid")
p5 <- ggplot(data=df, aes(x=x1, y=x2, colour=cl5)) +
  geom_point() +
  scale_color_brewer("", palette="Dark2") +
  xlab("") + ylab("") + theme_bw() +
  theme(aspect.ratio=1, legend.position="none") +
  ggtitle("wards")
p1 + p2 + p3 + p4 + p5 + plot_layout(ncol=3)
```

---
class: split-50
layout: false

.column[.pad10px[
# Nuisance variables

```{r out.width="90%", fig.width=4, fig.height=4}
set.seed(20190512)
df <- data.frame(x1=scale(c(rnorm(50, -4), rnorm(50, 4))),
                   x2=scale(c(rnorm(100))))
ggplot(data=df, aes(x1, x2)) + geom_point() +
    theme_bw() + theme(aspect.ratio=1)
```

]]
.column[.pad50px[

<br> <br> <br>
  
Variables that don't contribute to the clustering but are included in the distance calculations.

`x2` is a nuisance variable.

]]

---

```{r out.width="90%", fig.width=10, fig.height=6}
df_dist <- dist(df)
df_hc1 <- hclust(df_dist, method="single")
df_hc2 <- hclust(df_dist, method="complete")
df_hc3 <- hclust(df_dist, method="average")
df_hc4 <- hclust(df_dist, method="centroid")
df_hc5 <- hclust(df_dist, method="ward.D2")
p1 <- ggdendrogram(df_hc1, rotate = TRUE, size = 4) + ggtitle("single")
p2 <- ggdendrogram(df_hc2, rotate = TRUE, size = 4) + ggtitle("complete")
p3 <- ggdendrogram(df_hc3, rotate = TRUE, size = 4) + ggtitle("average")
p4 <- ggdendrogram(df_hc4, rotate = TRUE, size = 4) + ggtitle("centroid")
p5 <- ggdendrogram(df_hc5, rotate = TRUE, size = 4) + ggtitle("wards")
p1 + p2 + p3 + p4 + p5 + plot_layout(ncol=3)
```

---

```{r out.width="90%", fig.width=10, fig.height=6}
df$cl1 <- factor(cutree(df_hc1, 2))
df$cl2 <- factor(cutree(df_hc2, 2))
df$cl3 <- factor(cutree(df_hc3, 2))
df$cl4 <- factor(cutree(df_hc4, 2))
df$cl5 <- factor(cutree(df_hc5, 2))
p1 <- ggplot(data=df, aes(x=x1, y=x2, colour=cl1)) +
  geom_point() +
  scale_color_brewer("", palette="Dark2") +
  xlab("") + ylab("") + theme_bw() +
  theme(aspect.ratio=1, legend.position="none") + ggtitle("single")
p2 <- ggplot(data=df, aes(x=x1, y=x2, colour=cl2)) +
  geom_point() +
  scale_color_brewer("", palette="Dark2") +
  xlab("") + ylab("") + theme_bw() +
  theme(aspect.ratio=1, legend.position="none") +
  ggtitle("complete")
p3 <- ggplot(data=df, aes(x=x1, y=x2, colour=cl3)) +
  geom_point() +
  scale_color_brewer("", palette="Dark2") +
  xlab("") + ylab("") + theme_bw() +
  theme(aspect.ratio=1, legend.position="none") +
  ggtitle("average")
p4 <- ggplot(data=df, aes(x=x1, y=x2, colour=cl4)) +
  geom_point() +
  scale_color_brewer("", palette="Dark2") +
  xlab("") + ylab("") + theme_bw() +
  theme(aspect.ratio=1, legend.position="none") +
  ggtitle("centroid")
p5 <- ggplot(data=df, aes(x=x1, y=x2, colour=cl5)) +
  geom_point() +
  scale_color_brewer("", palette="Dark2") +
  xlab("") + ylab("") + theme_bw() +
  theme(aspect.ratio=1, legend.position="none") +
  ggtitle("wards")
p1 + p2 + p3 + p4 + p5 + plot_layout(ncol=3)
```

---


class: split-two

.column[.pad50px[


## Example - flea data

6 variables, 74 cases. Three very clear clusters. 

Data has a mix of nuisance variables and nuisance observations.

```{r}
data(flea)
scale2 <- function(x, na.rm = FALSE) (x - mean(x, na.rm = na.rm)) / sd(x, na.rm)
flea_std <- flea %>% mutate_if(is.numeric, list(scale2))
```

```{r eval=FALSE}
fpp <- save_history(flea_std[,2:7], guided_tour(lda_pp(flea_std$species), max.tries = 100),
  max = 100, rescale=FALSE)
fproj <- as_tibble(as.matrix(flea_std[,2:7])%*%matrix(fpp[1:6, 1:2, 10], ncol=2, byrow=FALSE))
save(fproj, file="data/fproj.rda")
```

```{r out.width="50%", fig.height=3, fig.width=3}
load("data/fproj.rda")
ggplot(fproj, aes(x=V1, y=V2)) + geom_point() +
  theme_minimal(base_size = 18) +
  theme(aspect.ratio=1) +
  xlab("") + ylab("")
```

Above is the 2D projection pursuit dimension reduction, using LDA index with true class.

]]

.column[.content.vmiddle[



```{r out.width="100%", fig.height=8, fig.width=8}
ggpairs(flea_std[,2:7]) + theme_minimal(base_size = 18) 
```

]]


---

```{r out.width="90%", fig.width=10, fig.height=6}
df_dist <- dist(flea_std[,2:7])
df_hc1 <- hclust(df_dist, method="single")
df_hc2 <- hclust(df_dist, method="complete")
df_hc3 <- hclust(df_dist, method="average")
df_hc4 <- hclust(df_dist, method="centroid")
df_hc5 <- hclust(df_dist, method="ward.D2")
p1 <- ggdendrogram(df_hc1, rotate = TRUE, size = 4) + ggtitle("single")
p2 <- ggdendrogram(df_hc2, rotate = TRUE, size = 4) + ggtitle("complete")
p3 <- ggdendrogram(df_hc3, rotate = TRUE, size = 4) + ggtitle("average")
p4 <- ggdendrogram(df_hc4, rotate = TRUE, size = 4) + ggtitle("centroid")
p5 <- ggdendrogram(df_hc5, rotate = TRUE, size = 4) + ggtitle("wards")
p1 + p2 + p3 + p4 + p5 + plot_layout(ncol=3)
```
---

Cluster solutions plotted in 2D projection pursuit dimension reduction, using LDA index with true class

```{r out.width="80%", fig.width=10, fig.height=6}
fproj$cl1 <- factor(cutree(df_hc1, 3))
fproj$cl2 <- factor(cutree(df_hc2, 3))
fproj$cl3 <- factor(cutree(df_hc3, 3))
fproj$cl4 <- factor(cutree(df_hc4, 3))
fproj$cl5 <- factor(cutree(df_hc5, 3))
p1 <- ggplot(data=fproj, aes(x=V1, y=V2, colour=cl1)) +
  geom_point() +
  scale_color_brewer("", palette="Dark2") +
  xlab("") + ylab("") + theme_bw() +
  theme(aspect.ratio=1, legend.position="none") + ggtitle("single")
p2 <- ggplot(data=fproj, aes(x=V1, y=V2, colour=cl2)) +
  geom_point() +
  scale_color_brewer("", palette="Dark2") +
  xlab("") + ylab("") + theme_bw() +
  theme(aspect.ratio=1, legend.position="none") +
  ggtitle("complete")
p3 <- ggplot(data=fproj, aes(x=V1, y=V2, colour=cl3)) +
  geom_point() +
  scale_color_brewer("", palette="Dark2") +
  xlab("") + ylab("") + theme_bw() +
  theme(aspect.ratio=1, legend.position="none") +
  ggtitle("average")
p4 <- ggplot(data=fproj, aes(x=V1, y=V2, colour=cl4)) +
  geom_point() +
  scale_color_brewer("", palette="Dark2") +
  xlab("") + ylab("") + theme_bw() +
  theme(aspect.ratio=1, legend.position="none") +
  ggtitle("centroid")
p5 <- ggplot(data=fproj, aes(x=V1, y=V2, colour=cl5)) +
  geom_point() +
  scale_color_brewer("", palette="Dark2") +
  xlab("") + ylab("") + theme_bw() +
  theme(aspect.ratio=1, legend.position="none") +
  ggtitle("wards")
p1 + p2 + p3 + p4 + p5 + plot_layout(ncol=3)
```

---
class: middle

<center>
.info-box[Note that, if clustering is conducted on the 2D projection, where clusters are well-separated, all linkage methods produce the three true clusters.

If we could do dimension reduction to remove nuisance variables prior to clustering, all would be so much easier. But this is hard.]

</center>

---

## Dendrogram in p-space

<br>

Examining the dendrogram in the high-dimensional data space can be done using the tour. You need to

1. Add points to the data to provide the places where the leaves join. These are the .monash-orange2[nodes] in the dendrogram.
2. Create a data set of .monash-orange2[edges], indicating which points should be connected.


---
  Dendrogram in $p$-dimensions (Wards and average linkage)

```{r eval=FALSE}
# Function to generate edges of dendrogram
hierfly <- function(data, h=NULL, metric="euclidean", method="ward.D2", scale=TRUE) {
  if (scale) data <- rescaler(data)
  id <- 1:nrow(data)
  cat <- sapply(data, is.factor)
  if (is.null(h))
    h <- hclust(dist(data[,!cat], metric), method)
  #h <- hclust(dist(data, metric), method)
  data_hc <- data

  data_hc$ORDER <- order(h$order)
  data_hc$HEIGHT <- 0
  data_hc$LEVEL <- 0
  data_hc$POINTS <- 1

  #newr_df <- NULL
  for (i in 1:nrow(h$merge)) {
    newr <- combinerows(data_hc[as.character(-h$merge[i,]),], cat)
    #newr <- combinerows(data_hc[as.character(-h$merge[i,]),], rownames(data))
    #newr$id <- nrow(data_hc) + i
    newr$HEIGHT <- h$height[i]
    newr$LEVEL <- i
    rownames(newr) <- as.character(-i)

    data_hc <- rbind(data_hc, newr)
  }
  data_hc$id <- 1:nrow(data_hc)
  data_hc$node <- (as.numeric(rownames(data_hc)) < 0) + 0

  vars <- c("ORDER", "POINTS")

  leaves <- subset(data_hc, node == 0)
  nodes <- subset(data_hc, node == 1)

  # < 0 = observation, > 0 = cluster
  edges <- h$merge
  edges[edges > 0] <- edges[edges > 0] + nrow(leaves)
  edges[edges < 0] <- abs(edges[edges < 0])

  return(list(data=data_hc, edges=edges))
}

# Utility functions
combinerows <- function(df, cat) {
  same <- function(x) if (length(unique(x)) == 1) x[1] else x[2]
  points <- df$POINTS

  cont <- as.data.frame(lapply(df[, !cat, drop=FALSE] * points,
                               sum)) / sum(points)
  cat <- as.data.frame(lapply(df[, cat, drop=FALSE], same))

  df <- if (nrow(cont) > 0 && nrow(cat) > 0) {
    cbind(cont, cat)
  } else if (nrow(cont) > 0) {
    cont
  } else {
    cat
  }
  df$POINTS <- sum(points)
  df
}

rescaler <- function(df) {
  is_numeric <- vapply(df, is.numeric, logical(1))
  df[is_numeric] <- lapply(df[is_numeric], rescale01)
  df
}

rescale01 <- function(x) {
  rng <- range(x, na.rm = TRUE)
  (x - rng[1]) / (rng[2] - rng[1])
}
```

```{r eval=FALSE}
# Make the dendrogram in p-D. Need to add nodes, and edges
flea_clw <- flea %>% mutate(cl = factor(cutree(df_hc5, 3)))
flea_cla <- flea %>% mutate(cl = factor(cutree(df_hc3, 3)))
flea_w_hfly <- hierfly(flea_clw, df_hc5)
flea_a_hfly <- hierfly(flea_cla, df_hc3)
```

```{r eval=FALSE}
# Build it all
library(RColorBrewer)
library(plotly)
library(htmltools)

pal <- brewer.pal(length(unique(flea_w_hfly$data$cl)), "Dark2")
colw <- pal[flea_w_hfly$data$cl]
cola <- pal[flea_a_hfly$data$cl]
glyphs <- c(16, 46)
pchw <- glyphs[flea_w_hfly$data$node+1]
pcha <- glyphs[flea_a_hfly$data$node+1]

# Use plotly to make animation
bases <- save_history(flea_w_hfly$data[, 1:6], max = 10)
tour_path <- interpolate(bases, 0.1)
d <- dim(tour_path)
hcw <- NULL
hcwe <- NULL
hca <- NULL
hcae <- NULL
for (i in 1:d[3]) {
  cat(i, "\n")
  d1 <- as.matrix(flea_w_hfly$data[,1:6]) %*% matrix(tour_path[,,i], ncol=2)
  colnames(d1) <- c("x", "y")
  d1 <- apply(d1, 2, function(x) x-mean(x))
  hcw <- rbind(hcw, cbind(d1, flea_w_hfly$data$cl, flea_w_hfly$data$node,                           rep(i+10, nrow(d1)))) # Add 10 bc plotly can't count single digits
  d2 <- as.matrix(flea_a_hfly$data[,1:6]) %*% matrix(tour_path[,,i], ncol=2)
  colnames(d2) <- c("x", "y")
  d2 <- apply(d2, 2, function(x) x-mean(x))
  hca <- rbind(hca, cbind(d2, flea_a_hfly$data$cl, flea_a_hfly$data$node,                           rep(i+10, nrow(d2))))
  e1 <- cbind(d1[flea_w_hfly$edges[,1],1],
              d1[flea_w_hfly$edges[,2],1],
              d1[flea_w_hfly$edges[,1],2],
              d1[flea_w_hfly$edges[,2],2],
              flea_w_hfly$data$cl[flea_w_hfly$edges[,1]],
              rep(i+10, nrow(flea_w_hfly$edges)))
  colnames(e1) <- c("x", "xend", "y", "yend", "cl", "indx")
  hcwe <- rbind(hcwe, e1)
  e2 <- cbind(d2[flea_a_hfly$edges[,1],1],
              d2[flea_a_hfly$edges[,2],1],
              d2[flea_a_hfly$edges[,1],2],
              d2[flea_a_hfly$edges[,2],2],
              flea_a_hfly$data$cl[flea_a_hfly$edges[,1]],
              rep(i+10, nrow(flea_a_hfly$edges)))
  colnames(e2) <- c("x", "xend", "y", "yend", "cl", "indx")
  hcae <- rbind(hcae, e2)
}
colnames(hcw)[3:5] <- c("cl", "node", "indx")
colnames(hca)[3:5] <- c("cl", "node", "indx")
hcw <- as_tibble(hcw)
hca <- as_tibble(hca)
hcw$cl <- as.factor(hcw$cl)
hca$cl <- as.factor(hca$cl)
hcw$node <- as.factor(hcw$node)
hca$node <- as.factor(hca$node)
hcwe <- as_tibble(hcwe)
hcae <- as_tibble(hcae)
hcwe$cl <- as.factor(hcwe$cl)
hcae$cl <- as.factor(hcae$cl)
# Plot it and make it into an animation
# Wards
p <- ggplot() +
  geom_segment(data = hcwe, aes(x=x, xend=xend, y=y, yend=yend, frame = indx, colour=cl)) +
  geom_point(data = hcw, aes(x = x, y = y, frame = indx, colour=cl, shape=node), size=1) +
  scale_shape_manual(values=c(16, 46)) +
  theme_void() +
  coord_fixed() +
  theme(legend.position="none") +
  scale_color_brewer("", palette="Dark2")
pg <- ggplotly(p, width=450, height=450) %>% animation_opts(200, redraw = FALSE, easing = "linear", transition=0)
save_html(pg, file="cluster_ward.html")
# Average
p <- ggplot() +
  geom_segment(data = hcae, aes(x=x, xend=xend, y=y, yend=yend, frame = indx, colour=cl)) +
  geom_point(data = hca, aes(x = x, y = y, frame = indx, colour=cl, shape=node), size=1) +
  scale_shape_manual(values=c(16, 46)) +
  theme_void() +
  coord_fixed() +
  theme(legend.position="none") +
  scale_color_brewer("", palette="Dark2")
pg <- ggplotly(p, width=450, height=450) %>% animation_opts(200, redraw = FALSE, easing = "linear", transition=0)
save_html(pg, file="cluster_average.html")
```

.pull-left[
  <iframe src="cluster_ward.html" width="400" height="500" scrolling="yes" seamless="seamless" frameBorder="0"> </iframe>
]
.pull-right[
  <iframe src="cluster_average.html" width="400" height="500" scrolling="yes" seamless="seamless" frameBorder="0"> </iframe>
]

---
class: transition middle

# Comparing cluster solutions

---

class: split-two

.column[.pad50px[
# Confusion table

Ward's linkage solution in columns, and average linkage in rows.

<br>

```{r}
flea_av_wd <- fproj %>% 
  dplyr::select(cl3, cl5) %>%
  rename(cl_av = cl3, 
         cl_ward = cl5)

flea_av_wd %>%
  count(cl_ward, cl_av) %>%
  pivot_wider(names_from = cl_ward, 
              values_from = n, 
              values_fill = 0) %>%
  kable() %>%
  kable_styling("striped", position = "center",
                row_label_position = "c", 
                font_size=24)
```
<br>
Solutions agree on 31 observations. Named differently: Wards labels group "3", and average labels it "2".

]]
.column[

<br><br>

Re-number the labels. Change average "2" to "3"

<br>
```{r}
flea_av_wd %>%
  count(cl_ward, cl_av) %>%
  mutate(cl_av = recode_factor(cl_av, "2"= "3", "3"="2")) %>%
  mutate(cl_av = factor(cl_av, levels = c("1", "2", "3"))) %>%
  pivot_wider(names_from = cl_ward, 
              values_from = n, 
              values_fill = 0) %>%
  arrange(cl_av) %>%
  kable() %>%
  kable_styling("striped", position = "center",
                row_label_position = "c", 
                font_size=24)
```

<br>
Now agreement can be viewed as numbers on main diagonal, as used in a labelled class confusion matrix.

Methods agree on 19+3+31 out of 74 observations, 71.6%. 
]

---
class: transition middle

# Summarising a clustering



---
# Clustering summaries

Once you have cluster labels, the data can be treated like data encountered in supervised classification

- Report means and standard deviations, and sample size of clusters
- Compute important variables, eg using random forests
- Dimension reduction using LDA (or PCA), to examine clusters
- Plot using colour for cluster label, using tour, parallel coordinates, scatterplot matrix

---
class: split-two

.column[.pad50px[
# Example

Summary statistics by cluster, .monash-orange2[in original units].

<br>
```{r}
flea_all <- flea %>%
  bind_cols(fproj)
flea_all %>%
  select(tars1:aede3, cl5) %>%
  group_by(cl5) %>%
  dplyr::summarise_if(is.numeric, list(m=mean, s=sd, n=length)) %>%
  pivot_longer(tars1_m:aede3_n, 
               names_to="var", values_to="estimate") %>%
  separate(var, c("var", "stat")) %>%
  pivot_wider(names_from = var, values_from = estimate) %>%
  select(cl5, stat, aede2, tars1, aede3, aede1, tars2, head) %>%
  kable(digits=2) %>% 
  kable_styling(bootstrap_options = "basic", 
                font_size = 16, 
                stripe_color = "#FFFFFF") %>%
  row_spec(0, color = "white", background = "#505050") %>%
  row_spec(c(1,4,7), background = "#F0F0F0") %>%
  row_spec(c(2,3,5,6,8,9), background = "#FFFFFF")
```
]]
.column[

```{r out.width="80%", fig.height = 10, fig.width=8}
ggparcoord(flea_all, columns = 2:7, groupColumn = 14, 
           order = "anyClass") + 
  facet_wrap(~flea_all$cl5, ncol=1) +
  theme(legend.position = "none")
```

]
---

```{r endslide, child="assets/endslide.Rmd"}
```

